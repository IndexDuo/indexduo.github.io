# ----------------------------------------------------------------------
# | GZip pre-compressed content                                        |
# ----------------------------------------------------------------------

# Serve gzip compressed CSS, JS, HTML, SVG, ICS, and JSON files if they exist
# and if the client accepts gzip encoding.
#
# (!) To make this part relevant, you need to generate encoded files by your
#     own. Enabling this part will not auto-generate gziped files.
#
# https://httpd.apache.org/docs/current/mod/mod_deflate.html#precompressed
#
# (1) Removing default MIME Type for .gz files allowing to add custom
#     sub-types.
#     You may prefer using less generic extensions such as .html_gz in order to
#     keep the default behavior regarding .gz files.
#     https://httpd.apache.org/docs/current/mod/mod_mime.html#removetype

<IfModule mod_rewrite.c>
    RewriteCond %{HTTP:Accept-Encoding} gzip
    RewriteCond %{REQUEST_FILENAME}\.gz -f
    RewriteRule \.(css|ics|js|json|html|svg)$ %{REQUEST_URI}.gz [L]

    # Prevent mod_deflate double gzip
    RewriteRule \.gz$ - [E=no-gzip:1]
</IfModule>

<IfModule mod_mime.c>
    # Serve correct encoding type for gzipped files
    AddEncoding gzip .gz

    # Global MIME type for JavaScript files
    AddType text/javascript .js
</IfModule>

<FilesMatch "\.gz$">
    <IfModule mod_mime.c>
        # Removing default MIME Type for .gz files allowing to add custom sub-types
        RemoveType gz

        # Serve correct content types for gzipped files
        AddType text/css              css.gz
        AddType text/calendar         ics.gz
        AddType application/json      json.gz
        AddType text/html             html.gz
        AddType image/svg+xml         svg.gz
        AddType text/javascript .js
        AddType application/javascript .mjs

        <IfModule mod_mime.c>
    # Serve correct encoding type for gzipped files
    AddEncoding gzip .gz






        # Serve correct content charset for gzipped files
        AddCharset utf-8 .css.gz \
                         .ics.gz \
                         .json.gz \
                         .html.gz \
                         .svg.gz
    </IfModule>

    <IfModule mod_headers.c>
        # Force proxies to cache gzipped and non-gzipped files separately
        Header append Vary Accept-Encoding
    </IfModule>
</FilesMatch>
